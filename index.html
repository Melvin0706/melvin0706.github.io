<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Multi-Room Firebase Comment Section</title>
  <style>
    body { font-family: Arial, sans-serif; max-width: 600px; margin: auto; padding: 1em; }
    #comment-section { margin-top: 2em; }
    .comment { border: 1px solid #ccc; padding: 0.5em; margin-bottom: 0.5em; position: relative; }
    .delete-btn { position: absolute; top: 5px; right: 10px; cursor: pointer; color: red; }
  </style>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
</head>
<body>
  <h2>Comment Section</h2>
  <div id="user-info"></div>
  <button id="sign-in">Sign in with Google</button>
  <button id="sign-out" style="display:none">Sign Out</button>

  <div id="comment-section" style="display:none">
    <textarea id="comment-input" placeholder="Enter your comment"></textarea><br>
    <button onclick="postComment()">Post Comment</button>
    <div id="comments"></div>
  </div>

  <script>
    // Firebase Config
    const firebaseConfig = {
      apiKey: "YOUR_API_KEY",
      authDomain: "YOUR_PROJECT_ID.firebaseapp.com",
      databaseURL: "https://YOUR_PROJECT_ID.firebaseio.com",
      projectId: "YOUR_PROJECT_ID",
      storageBucket: "YOUR_PROJECT_ID.appspot.com",
      messagingSenderId: "YOUR_SENDER_ID",
      appId: "YOUR_APP_ID"
    };
    firebase.initializeApp(firebaseConfig);
    const database = firebase.database();

    let room = new URLSearchParams(window.location.search).get("room") || "default";
    let user = null;

    const signInBtn = document.getElementById("sign-in");
    const signOutBtn = document.getElementById("sign-out");
    const userInfo = document.getElementById("user-info");
    const commentSection = document.getElementById("comment-section");

    signInBtn.onclick = () => {
      const provider = new firebase.auth.GoogleAuthProvider();
      firebase.auth().signInWithPopup(provider).catch(console.error);
    };

    signOutBtn.onclick = () => firebase.auth().signOut();

    firebase.auth().onAuthStateChanged(u => {
      user = u;
      if (user) {
        userInfo.textContent = `Signed in as ${user.displayName}`;
        signInBtn.style.display = 'none';
        signOutBtn.style.display = 'inline';
        commentSection.style.display = 'block';
        loadComments();
      } else {
        userInfo.textContent = '';
        signInBtn.style.display = 'inline';
        signOutBtn.style.display = 'none';
        commentSection.style.display = 'none';
      }
    });

    function postComment() {
      const text = document.getElementById("comment-input").value;
      if (!text.trim()) return;
      const comment = {
        text: text,
        userName: user.displayName,
        uid: user.uid
      };
      database.ref(`comments/${room}`).push(comment);
      document.getElementById("comment-input").value = "";
    }

    function loadComments() {
      const commentsDiv = document.getElementById("comments");
      database.ref(`comments/${room}`).on("value", snapshot => {
        commentsDiv.innerHTML = "";
        snapshot.forEach(child => {
          const key = child.key;
          const comment = child.val();
          const commentElement = document.createElement("div");
          commentElement.className = "comment";
          commentElement.textContent = `${comment.userName}: ${comment.text}`;

          if (user && comment.uid === user.uid) {
            const deleteBtn = document.createElement("div");
            deleteBtn.className = "delete-btn";
            deleteBtn.textContent = "Ã—";
            deleteBtn.onclick = () => {
              database.ref(`comments/${room}/${key}`).remove();
            };
            commentElement.appendChild(deleteBtn);
          }

          commentsDiv.appendChild(commentElement);
        });
      });
    }
  </script>
</body>
</html>
